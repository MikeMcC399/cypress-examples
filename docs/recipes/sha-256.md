# Compute SHA256 from HTML

<!-- fiddle Compute SHA-256 digest -->

```html
<div id="greeting">
  <span id="form">Hello</span>, <span id="target">World</span>!
</div>
```

Here is an example async function computing the SHA-256 digest using the browser built-in APIs. Take from [Mozilla Docs](https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/digest)

```js hide
async function digestMessage(message) {
  // encode as (utf-8) Uint8Array
  const msgUint8 = new TextEncoder().encode(message)
  const hashBuffer = await crypto.subtle.digest(
    'SHA-256',
    msgUint8,
  ) // hash the message
  const hashArray = Array.from(new Uint8Array(hashBuffer))
  const hashHex = hashArray
    .map((b) => b.toString(16).padStart(2, '0'))
    .join('') // convert bytes to hex string
  return hashHex
}
```

We can compute SHA of any element (I like trimming the HTML string before computing its digest)

```js skip
cy.get('#greeting')
  .invoke('html')
  .invoke('trim')
  .then(digestMessage)
  .should('be.a', 'string')
```

Let's confirm the SHA changes when the HTML inside the element changes.

```js
cy.get('#greeting')
  .invoke('html')
  .invoke('trim')
  .then(digestMessage)
  .should('be.a', 'string')
  .then((sha) => {
    // change something on the page
    cy.get('#target').invoke('text', 'You')
    cy.get('#greeting')
      .invoke('html')
      .invoke('trim')
      // sha changes
      .then(digestMessage)
      .should('not.equal', sha)
  })
```

If we plan to compute SHA across our project, we can create a custom child command

```js
Cypress.Commands.add(
  'sha',
  { prevSubject: 'element' },
  ($el) => {
    // put a message to Command Log
    Cypress.log({ name: 'sha' })
    const html = $el.html().trim()
    return digestMessage(html)
  },
)
```

Let's use the new `cy.sha` command to confirm the SHA changes when the element's HTML changes

```js
cy.get('#greeting')
  .sha()
  .then((t) => {
    cy.get('#target').invoke('text', 'everyone')
    cy.get('#greeting').sha().should('not.equal', t)
  })
```

**Warning:** the above test is _bad practice_. The SHA of HTML can change for many reasons, your tests should confirm the HTML changes _in the expected_ way.

<!-- fiddle-end -->
